<% layout('layout.html') %>

<% it.pages.forEach(page => { %>
  <article>
    <h2><%= page.metadata.name %></h2>

    <% it.blocks.forEach(block => { %>
      <details open>
        <summary><%= block.metadata.type %></summary>
        <p>
          <% if (block.metadata.type !== 'image') { %>
            <form id="block-update" method="post" action="/blocks/<%= block.idBlock %>/update">
              <fieldset role="group">
                <textarea name="data"><%= block.payload %></textarea>
                <button class="outline" type="submit">Update</button>
              </fieldset>

              <input type="hidden" name="type" value="<%= block.metadata.type %>">
              <input type="hidden" name="idPage" value="<%= page.idPage %>">
            </form>
          <% } %>

          <% if (block.metadata.type === 'javascript') { %>
            <figure>
            <%= block.output %>
            </figure>
          <% } %>

          <% if (block.metadata.type === 'image') { %>
          <figure>
            <img src="<%= block.output %>">
          </figure>
          <% } %>

          <a class="outline secondary" href="/pages/<%= page.idPage %>/block/<%= block.idBlock %>/delete" role="button">Delete</a>
        </p>
      </details>

      <hr>
    <% }) %>

    <%~ include('block-form.html', { page }) %>
  </article>
<% }) %>

