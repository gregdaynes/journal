<% layout('layout.html') %>

<% it.pages.forEach(page => { %>
  <article>
    <h2><%= page.metadata.name %></h2>

    <% it.blocks.forEach(block => { %>
      <details open>
        <summary><%= block.metadata.type %></summary>

        <div>
          <% if (block.metadata.type !== 'image') { %>
            <form id=`block-update-${block.idBlock}` method="post" action="/blocks/<%= block.idBlock %>/update">
              <fieldset role="group">
                <textarea name="data"><%= block.payload %></textarea>
              </fieldset>

              <input type="hidden" name="type" value="<%= block.metadata.type %>">
              <input type="hidden" name="idPage" value="<%= page.idPage %>">
            </form>
          <% } %>

          <% if (block.metadata.type === 'javascript') { %>
            <textarea readonly><%= block.output %></textarea>
          <% } %>

          <% if (block.metadata.type === 'image') { %>
          <figure>
            <img src="<%= block.output %>">
          </figure>
          <% } %>
        </div>

        <div role="group">
          <button class="outline" type="submit" form=`block-update-${block.idBlock}`>Update</button>
          <a class="outline secondary" href="/pages/<%= page.idPage %>/block/<%= block.idBlock %>/delete" role="button">Delete</a>
        </div>
      </details>

      <hr>
    <% }) %>

    <%~ include('block-form.html', { page }) %>
  </article>
<% }) %>

